<% if Current.session&.user&.can_create_products? %>
  <!-- Manager/Head Dashboard - Full Width Design -->
  <div class="w-full">
    <!-- Welcome Header -->
    <div class="sm:flex sm:items-center sm:justify-between mb-8">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Dashboard</h1>
        <p class="mt-2 text-sm text-gray-700">
          Welcome back, <%= Current.session.user.role.capitalize %>! Overview of your factory management system.
        </p>
      </div>
      <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
        <div class="flex gap-3">
          <%= link_to new_product_path, class: "inline-flex items-center justify-center rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600" do %>
            <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
            </svg>
            New Product
          <% end %>
          <%= link_to products_path, class: "inline-flex items-center justify-center rounded-md bg-white px-4 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50" do %>
            <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" />
              <path fill-rule="evenodd" d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.147.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41z" clip-rule="evenodd" />
            </svg>
            View All Products
          <% end %>
        </div>
      </div>
    </div>
    <!-- Key Metrics - Expanded Grid -->
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 mb-10">
      <!-- Total Products -->
      <div class="relative overflow-hidden rounded-lg bg-white px-6 py-6 shadow-sm ring-1 ring-gray-900/5 hover:shadow-lg transition-shadow">
        <div>
          <dt class="truncate text-sm font-medium text-gray-500">Total Products</dt>
          <dd class="mt-2 text-4xl font-bold tracking-tight text-gray-900"><%= @total_products %></dd>
        </div>
        <div class="absolute inset-y-0 right-0 flex items-center pr-6">
          <svg class="h-10 w-10 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
          </svg>
        </div>
      </div>
      <!-- My Products -->
      <div class="relative overflow-hidden rounded-lg bg-white px-6 py-6 shadow-sm ring-1 ring-gray-900/5 hover:shadow-lg transition-shadow">
        <div>
          <dt class="truncate text-sm font-medium text-gray-500">My Products</dt>
          <dd class="mt-2 text-4xl font-bold tracking-tight text-gray-900"><%= @my_products_count %></dd>
        </div>
        <div class="absolute inset-y-0 right-0 flex items-center pr-6">
          <svg class="h-10 w-10 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        </div>
      </div>
      <!-- Total Ingredients -->
      <div class="relative overflow-hidden rounded-lg bg-white px-6 py-6 shadow-sm ring-1 ring-gray-900/5 hover:shadow-lg transition-shadow">
        <div>
          <dt class="truncate text-sm font-medium text-gray-500">Total Ingredients</dt>
          <dd class="mt-2 text-4xl font-bold tracking-tight text-gray-900"><%= @total_ingredients %></dd>
        </div>
        <div class="absolute inset-y-0 right-0 flex items-center pr-6">
          <svg class="h-10 w-10 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
        </div>
      </div>
      <!-- This Week -->
      <div class="relative overflow-hidden rounded-lg bg-white px-6 py-6 shadow-sm ring-1 ring-gray-900/5 hover:shadow-lg transition-shadow">
        <div>
          <dt class="truncate text-sm font-medium text-gray-500">Created This Week</dt>
          <dd class="mt-2 text-4xl font-bold tracking-tight text-gray-900"><%= @products_this_week %></dd>
        </div>
        <div class="absolute inset-y-0 right-0 flex items-center pr-6">
          <svg class="h-10 w-10 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
          </svg>
        </div>
      </div>
      <!-- Average Ingredients -->
      <div class="relative overflow-hidden rounded-lg bg-white px-6 py-6 shadow-sm ring-1 ring-gray-900/5 hover:shadow-lg transition-shadow">
        <div>
          <dt class="truncate text-sm font-medium text-gray-500">Avg Ingredients</dt>
          <dd class="mt-2 text-4xl font-bold tracking-tight text-gray-900"><%= @avg_ingredients %></dd>
        </div>
        <div class="absolute inset-y-0 right-0 flex items-center pr-6">
          <svg class="h-10 w-10 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
        </div>
      </div>
      <!-- Team Products -->
      <div class="relative overflow-hidden rounded-lg bg-white px-6 py-6 shadow-sm ring-1 ring-gray-900/5 hover:shadow-lg transition-shadow">
        <div>
          <dt class="truncate text-sm font-medium text-gray-500">Team Products</dt>
          <dd class="mt-2 text-4xl font-bold tracking-tight text-gray-900"><%= @team_products_count %></dd>
        </div>
        <div class="absolute inset-y-0 right-0 flex items-center pr-6">
          <svg class="h-10 w-10 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
        </div>
      </div>
    </div>
    <!-- Three Column Layout - Full Width -->
    <div class="grid grid-cols-1 gap-8 xl:grid-cols-3">
      <!-- Recent Products - Wider -->
      <div class="xl:col-span-2 bg-white shadow-sm rounded-lg ring-1 ring-gray-900/5">
        <div class="px-8 py-6 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-xl font-semibold text-gray-900">Recent Products</h3>
            <%= link_to "View all", products_path, class: "text-base font-medium text-blue-600 hover:text-blue-500" %>
          </div>
        </div>
        <div class="divide-y divide-gray-200">
          <% if @recent_products.any? %>
            <% @recent_products.each do |product| %>
              <div class="px-8 py-6 hover:bg-gray-50 transition-colors">
                <div class="flex items-center justify-between">
                  <div class="flex items-center min-w-0 flex-1">
                    <div class="h-12 w-12 flex-shrink-0">
                      <div class="h-12 w-12 rounded-lg bg-blue-100 flex items-center justify-center">
                        <svg class="h-7 w-7 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                        </svg>
                      </div>
                    </div>
                    <div class="ml-6 min-w-0 flex-1">
                      <div class="flex items-center">
                        <p class="text-base font-semibold text-gray-900 truncate">
                          <%= link_to product.name, product_path(product), class: "hover:text-blue-600" %>
                        </p>
                        <span class="ml-3 inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800">
                          <%= product.ingredients.count %> ingredients
                        </span>
                      </div>
                      <p class="text-base text-gray-500 mt-1">
                        Created by <%= product.user.role.capitalize %> â€¢ <%= time_ago_in_words(product.created_at) %> ago
                      </p>
                    </div>
                  </div>
                  <div class="flex items-center space-x-3">
                    <%= link_to product_path(product), class: "text-gray-400 hover:text-gray-600" do %>
                      <svg class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                      </svg>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="px-8 py-6 text-center">
              <p class="text-base text-gray-500">No products created yet</p>
            </div>
          <% end %>
        </div>
      </div>
      <!-- Statistics & Quick Actions Sidebar -->
      <div class="space-y-8">
        <!-- Products by Role -->
        <div class="bg-white shadow-sm rounded-lg ring-1 ring-gray-900/5">
          <div class="px-6 py-5 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Products by Role</h3>
          </div>
          <div class="p-6">
            <% if @products_by_role.any? %>
              <% @products_by_role.each do |role, count| %>
                <div class="flex items-center justify-between py-3">
                  <div class="flex items-center">
                    <div class="h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center mr-4">
                      <span class="text-sm font-semibold text-gray-600"><%= role.capitalize.first %></span>
                    </div>
                    <span class="text-base font-medium text-gray-900 capitalize"><%= role %></span>
                  </div>
                  <span class="text-base font-semibold text-gray-500"><%= count %></span>
                </div>
              <% end %>
            <% else %>
              <p class="text-base text-gray-500 text-center py-6">No data available</p>
            <% end %>
          </div>
        </div>
        <!-- Quick Actions -->
        <div class="bg-white shadow-sm rounded-lg ring-1 ring-gray-900/5">
          <div class="px-6 py-5 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Quick Actions</h3>
          </div>
          <div class="p-6 space-y-4">
            <%= link_to new_product_path, class: "flex items-center p-4 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors" do %>
              <svg class="h-8 w-8 text-blue-600 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              <div>
                <div class="text-base font-semibold text-blue-900">Create New Product</div>
                <div class="text-sm text-blue-700">Add a new product to the system</div>
              </div>
            <% end %>
            <%= link_to products_path, class: "flex items-center p-4 rounded-lg bg-green-50 hover:bg-green-100 transition-colors" do %>
              <svg class="h-8 w-8 text-green-600 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
              </svg>
              <div>
                <div class="text-base font-semibold text-green-900">Manage Products</div>
                <div class="text-sm text-green-700">View and edit existing products</div>
              </div>
            <% end %>
            <% if Current.session.user.head? %>
              <div class="flex items-center p-4 rounded-lg bg-purple-50">
                <svg class="h-8 w-8 text-purple-600 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <div>
                  <div class="text-base font-semibold text-purple-900">System Analytics</div>
                  <div class="text-sm text-purple-700">Advanced reporting (Coming Soon)</div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <!-- Basic view for Workers, Testers, Supervisors - Full Width -->
  <div class="w-full max-w-none">
    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold text-gray-900 mb-6">
        Welcome to Factory Management System
      </h1>
      <p class="text-xl text-gray-600 mb-8">
        Hello, <%= Current.session.user.role.capitalize %>! Here's what you can view:
      </p>
    </div>
    <!-- Recent Products for Regular Users - Full Width Grid -->
    <div class="bg-white shadow-sm rounded-lg ring-1 ring-gray-900/5 mb-10">
      <div class="px-8 py-6 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-900">Recent Products</h3>
      </div>
      <% if @recent_products.any? %>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 p-8">
          <% @recent_products.each do |product| %>
            <div class="border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow">
              <h4 class="font-semibold text-gray-900 mb-3 text-lg"><%= product.name %></h4>
              <p class="text-base text-gray-600 mb-3">
                Created by: <%= product.user.role.capitalize %>
              </p>
              <p class="text-base text-gray-600 mb-4">
                Ingredients: <%= product.ingredients.count %>
              </p>
              <%= link_to "View Details", product_path(product), 
                  class: "inline-flex items-center text-base font-medium text-blue-600 hover:text-blue-500" %>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="px-8 py-12 text-center">
          <p class="text-gray-500 text-lg">No products available to view</p>
        </div>
      <% end %>
    </div>
    <!-- Quick Links for Regular Users - Full Width -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div class="bg-blue-50 rounded-lg p-8">
        <h3 class="text-xl font-semibold text-blue-900 mb-3">View Products</h3>
        <p class="text-blue-700 mb-6">Browse all available products in the system</p>
        <%= link_to "Browse Products", products_path, 
            class: "inline-flex items-center text-base font-medium text-blue-600 hover:text-blue-500" %>
      </div>
      <div class="bg-green-50 rounded-lg p-8">
        <h3 class="text-xl font-semibold text-green-900 mb-3">Your Role</h3>
        <p class="text-green-700 mb-6">You are currently logged in as a <%= Current.session.user.role.capitalize %></p>
        <span class="inline-flex items-center rounded-full bg-green-100 px-4 py-2 text-base font-medium text-green-800">
          <%= Current.session.user.role.capitalize %>
        </span>
      </div>
      <div class="bg-gray-50 rounded-lg p-8">
        <h3 class="text-xl font-semibold text-gray-900 mb-3">Factory Info</h3>
        <p class="text-gray-700 mb-6">Learn more about our factory management system</p>
        <span class="inline-flex items-center text-base font-medium text-gray-600">
          System Status: Active
        </span>
      </div>
    </div>
  </div>
<% end %>
