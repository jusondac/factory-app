<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title><%= @report_type.humanize %> Report - <%= @start_date.strftime("%b %d, %Y") %> to <%= @end_date.strftime("%b %d, %Y") %></title>
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 12px;
        line-height: 1.4;
        color: #333;
        margin: 0;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #2563eb;
        padding-bottom: 20px;
      }

      .header h1 {
        color: #2563eb;
        margin: 0;
        font-size: 24px;
      }

      .header p {
        color: #666;
        margin: 5px 0;
        font-size: 14px;
      }

      .summary {
        background-color: #f8fafc;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid #e2e8f0;
      }

      .summary-grid {
        display: table;
        width: 100%;
        margin-top: 10px;
      }

      .summary-item {
        display: table-cell;
        text-align: center;
        padding: 10px;
      }

      .summary-item .label {
        font-size: 11px;
        color: #64748b;
        margin-bottom: 5px;
      }

      .summary-item .value {
        font-size: 18px;
        font-weight: bold;
        color: #1e293b;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th, td {
        border: 1px solid #e2e8f0;
        padding: 8px 12px;
        text-align: left;
        vertical-align: top;
      }

      th {
        background-color: #f1f5f9;
        font-weight: bold;
        color: #374151;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .date-header {
        background-color: #eff6ff !important;
        font-weight: bold;
        color: #1e40af;
      }

      .date-header td {
        padding: 12px;
        border-bottom: 2px solid #3b82f6;
      }

      .status-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .status-preparation { background-color: #dbeafe; color: #1e40af; }
      .status-production { background-color: #fef3c7; color: #92400e; }
      .status-testing { background-color: #e9d5ff; color: #6b21a8; }
      .status-packing { background-color: #d1fae5; color: #065f46; }
      .status-cancelled { background-color: #fee2e2; color: #dc2626; }

      .process-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }

      .process-tag {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 9px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .process-prepare { background-color: #dbeafe; color: #1e40af; }
      .process-produce { background-color: #fef3c7; color: #92400e; }
      .process-package { background-color: #d1fae5; color: #065f46; }

      .footer {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e2e8f0;
        text-align: center;
        font-size: 10px;
        color: #64748b;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1><%= @report_type.humanize %> Report</h1>
      <p>Generated on <%= Time.current.strftime("%B %d, %Y at %I:%M %p") %></p>
      <p>Report Period: <%= @start_date.strftime("%b %d, %Y") %> - <%= @end_date.strftime("%b %d, %Y") %></p>
    </div>
    <div class="summary">
      <h3 style="margin: 0 0 10px 0; color: #374151;">Report Summary</h3>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="label">Total Batches</div>
          <div class="value"><%= @report_data.values.flatten.count %></div>
        </div>
        <div class="summary-item">
          <div class="label">Completed</div>
          <div class="value" style="color: #065f46;"><%= @report_data.values.flatten.select { |ub| ub.status == 'packing' }.count %></div>
        </div>
        <div class="summary-item">
          <div class="label">In Progress</div>
          <div class="value" style="color: #92400e;"><%= @report_data.values.flatten.select { |ub| ['preparation', 'production'].include?(ub.status) }.count %></div>
        </div>
        <div class="summary-item">
          <div class="label">Cancelled</div>
          <div class="value" style="color: #dc2626;"><%= @report_data.values.flatten.select { |ub| ub.status == 'cancelled' }.count %></div>
        </div>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th style="width: 15%;">Unit Batch</th>
          <th style="width: 20%;">Product</th>
          <th style="width: 10%;">Status</th>
          <th style="width: 25%;">Processes</th>
          <th style="width: 10%;">Quantity</th>
          <th style="width: 20%;">Date</th>
        </tr>
      </thead>
      <tbody>
        <% @report_data.each do |date, unit_batches| %>
          <tr class="date-header">
            <td colspan="6">
              ðŸ“… <%= date.strftime("%B %d, %Y") %> (<%= unit_batches.count %> batch<%= 'es' if unit_batches.count != 1 %>)
            </td>
          </tr>
          <% unit_batches.each do |unit_batch| %>
            <tr>
              <td>
                <div style="font-weight: bold; color: #1e293b;"><%= unit_batch.unit_id %></div>
                <div style="font-size: 10px; color: #64748b;"><%= unit_batch.batch_code %></div>
              </td>
              <td>
                <div><%= unit_batch.product&.name || 'No product' %></div>
              </td>
              <td>
                <span class="status-badge status-<%= unit_batch.status %>">
                  <%= unit_batch.status.humanize %>
                </span>
              </td>
              <td>
                <div class="process-tags">
                  <% if unit_batch.prepare %>
                    <span class="process-tag process-prepare">âœ“ Prepare</span>
                  <% end %>
                  <% if unit_batch.produce %>
                    <span class="process-tag process-produce">âœ“ Produce</span>
                  <% end %>
                  <% if unit_batch.package %>
                    <span class="process-tag process-package">âœ“ Package</span>
                  <% end %>
                </div>
              </td>
              <td><%= unit_batch.quantity %></td>
              <td><%= date.strftime("%b %d, %Y") %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
    <div class="footer">
      <p>Report generated by Factory Management System</p>
      <p>Â© <%= Time.current.year %> All rights reserved</p>
    </div>
  </body>
</html>
