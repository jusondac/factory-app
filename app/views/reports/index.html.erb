<% content_for :title, "Reports" %>
<!-- Reports Page -->
<div class="bg-gray-50 w-screen">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
    <!-- Page Header -->
    <div class="mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Reports</h1>
          <p class="mt-1 text-sm text-gray-600">Generate and view factory reports</p>
        </div>
        <% if @show_data %>
          <div class="flex space-x-3">
            <%= link_to reports_path(format: :pdf, report_type: @report_type, start_date: @start_date, end_date: @end_date),
                class: "inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors duration-200" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Download PDF
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    <!-- Inline Filter Form -->
    <div class="mb-6">
      <div class="relative bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 rounded-xl shadow-lg border border-blue-100 p-4 backdrop-blur-sm">
        <div class="flex items-center mb-3">
          <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.121A1 1 0 013 6.414V4z"></path>
            </svg>
          </div>
          <div class="ml-3">
            <h3 class="text-base font-bold text-gray-900">Report Filters</h3>
            <p class="text-xs text-gray-600">Select type and date range to generate report</p>
          </div>
        </div>
        <%= form_with url: reports_path, method: :get, local: true, class: "space-y-3", id: "report-form" do |f| %>
          <!-- Inline Filter Controls -->
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-3 items-end">
            <!-- Report Type -->
            <div class="lg:col-span-4">
              <label class="block text-xs font-semibold text-gray-700 mb-1">
                Report Type
              </label>
              <%= f.select :report_type,
                  options_for_select([
                    ['Unit Batch', 'unit_batch'],
                    ['Core Process', 'core_process'],
                    ['Ingredients-Product-Machine', 'ingredients_product_machine']
                  ], @report_type),
                  { include_blank: 'Select Report Type' },
                  { class: "w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white/70 backdrop-blur-sm shadow-sm transition-all duration-200 hover:shadow-md",
                    required: true } %>
            </div>
            <!-- Start Date -->
            <div class="lg:col-span-3">
              <label class="block text-xs font-semibold text-gray-700 mb-1">
                Start Date
              </label>
              <%= f.date_field :start_date,
                  value: @start_date,
                  min: @min_date,
                  max: Date.current,
                  class: "w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white/70 backdrop-blur-sm shadow-sm transition-all duration-200 hover:shadow-md",
                  required: true %>
            </div>
            <!-- End Date -->
            <div class="lg:col-span-3">
              <label class="block text-xs font-semibold text-gray-700 mb-1">
                End Date
              </label>
              <%= f.date_field :end_date,
                  value: @end_date,
                  min: @min_date,
                  max: Date.current,
                  class: "w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white/70 backdrop-blur-sm shadow-sm transition-all duration-200 hover:shadow-md",
                  required: true %>
            </div>
            <!-- Action Buttons -->
            <div class="lg:col-span-2 flex space-x-2">
              <%= f.submit "Generate", class: "flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-3 py-2 text-sm rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl font-semibold" %>
              <%= link_to "Clear", reports_path, class: "px-3 py-2 border border-gray-200 text-gray-700 text-sm rounded-lg hover:bg-white/80 transition-all duration-200 shadow-sm hover:shadow-md bg-white/50 backdrop-blur-sm" %>
            </div>
          </div>
          <!-- Mobile Layout (stacked on small screens) -->
          <div class="lg:hidden grid grid-cols-1 gap-3">
            <div class="flex space-x-2">
              <%= f.submit "🔍 Generate Report", class: "flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2 text-sm rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl font-semibold" %>
              <%= link_to "Clear Filters", reports_path, class: "px-4 py-2 border border-gray-200 text-gray-700 text-sm rounded-lg hover:bg-white/80 transition-all duration-200 shadow-sm hover:shadow-md bg-white/50 backdrop-blur-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- Table Section -->
<% if @show_data %>
  <div class="bg-gray-50">
    <div class="mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="relative bg-gradient-to-br from-slate-50 via-gray-50 to-zinc-50 rounded-xl shadow-lg border border-gray-100 overflow-hidden backdrop-blur-sm max-w-6xl mx-auto">
        <!-- Header -->
        <div class="relative px-6 py-4 border-b border-gray-200/50 bg-white/30 backdrop-blur-sm">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-gradient-to-r from-slate-600 to-gray-700 rounded-lg flex items-center justify-center shadow-md mr-3">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
              </div>
              <h3 class="text-lg font-bold text-gray-900"><%= @report_type.humanize.titleize %> Report</h3>
            </div>
            <span class="text-sm text-gray-600 bg-white/50 backdrop-blur-sm px-3 py-1 rounded-lg border border-white/20">
              <%= @report_data.values.flatten.count %> records
            </span>
          </div>
        </div>
        <% if @report_data.any? %>
          <!-- Table -->
          <div class="relative overflow-x-auto">
            <table class="table-auto min-w-full border-collapse border border-gray-300">
              <%= render "reports/#{@report_type}_table" %>
            </table>
          </div>
        <% else %>
          <!-- Empty State -->
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">No report data found</h3>
            <p class="mt-1 text-sm text-gray-500">Try adjusting your date range or report type.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
